<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>15 Web scraping ‚Äì COMP/STAT212 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../src/appx/Exam2SummarySheet.html" rel="next">
<link href="../../src/ica/14-apis-2-notes.html" rel="prev">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5c3a6d2a25238f373e9093014fa3b5df.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-988ea1941520f085a68ecd70cc215186.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-5c3a6d2a25238f373e9093014fa3b5df.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="../../style/custom.css">
</head>
<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../src/ica/ica-introduction.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../src/ica/15-scraping-notes.html"><span class="chapter-title">15 Web scraping</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../assets/sidebar-logo.png" alt="Random negative space illustration" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Shurui Zhang</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">TidyTuesday</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/hw01-tt.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Homework 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/hw02-tt.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Homework 02</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">In-Class Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/ica-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Cleaning SFO Weather Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/03-adv-ggplot-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3 Advanced Data Viz</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/04_adv_maps/code/04-adv-maps-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4 Advanced Spatial Viz P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/06-wrangling-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6 Adv Data wrangling P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/07-wrangling-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7 Adv Data wrangling P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/08-missing-data-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8 Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/09-functions-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9 Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/10-base-r-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10 Base R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/11-iteration-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">11 Loops+Iter P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/12-iteration-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12 Loops+Iter P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/14-apis-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">14 APIs P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/15-scraping-notes.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">15 Web scraping</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/appx/Exam2SummarySheet.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">‚Äî</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">üß© Learning Goals</a></li>
  <li><a href="#when-to-use" id="toc-when-to-use" class="nav-link" data-scroll-target="#when-to-use">When to Use</a></li>
  <li><a href="#ethics" id="toc-ethics" class="nav-link" data-scroll-target="#ethics">Ethics</a></li>
  <li><a href="#html-structure" id="toc-html-structure" class="nav-link" data-scroll-target="#html-structure">HTML structure</a></li>
  <li><a href="#finding-css-selectors" id="toc-finding-css-selectors" class="nav-link" data-scroll-target="#finding-css-selectors">Finding CSS Selectors</a></li>
  <li><a href="#example-1-nih-new-releases" id="toc-example-1-nih-new-releases" class="nav-link" data-scroll-target="#example-1-nih-new-releases">Example 1: NIH New Releases</a></li>
  <li><a href="#retrieving-data-using-rvest-and-css-selectors" id="toc-retrieving-data-using-rvest-and-css-selectors" class="nav-link" data-scroll-target="#retrieving-data-using-rvest-and-css-selectors">Retrieving Data Using <code>rvest</code> and CSS Selectors</a></li>
  <li><a href="#example-2-nih-stem-teaching-resources" id="toc-example-2-nih-stem-teaching-resources" class="nav-link" data-scroll-target="#example-2-nih-stem-teaching-resources">Example 2: NIH STEM Teaching Resources</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../src/ica/ica-introduction.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../src/ica/15-scraping-notes.html"><span class="chapter-title">15 Web scraping</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">15 Web scraping</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><section id="learning-goals" class="level2"><h2 class="anchored" data-anchor-id="learning-goals">üß© Learning Goals</h2>
<p>By the end of this lesson, you should be able to: - Use CSS Selectors and the Selector Gadget tool to locate data of interest within a webpage - Use the <code>html_elements()</code>, <code>html_text()</code>, and <code>html_attr()</code> functions within the <code>rvest</code> packages to scrape data from webpage using CSS selectors.</p>
</section><section id="when-to-use" class="level2"><h2 class="anchored" data-anchor-id="when-to-use">When to Use</h2>
<p>We have talked about how to acquire data from APIs. Whenever an API is available for your project, you should default to getting data from the API. Sometimes an API will not be available, and <strong>web scraping</strong> is another means of getting data.</p>
<p>Web scraping describes the use of code to extract information displayed on a web page. In R, the <code>rvest</code> package offers tools for scraping. (<code>rvest</code> is meant to sound like ‚Äúharvest‚Äù.)</p>
</section><section id="ethics" class="level2"><h2 class="anchored" data-anchor-id="ethics">Ethics</h2>
<p><code>robots.txt</code> is a file that some websites includes to clarify what can and cannot be scraped in addition to other constraints about scraping. When a website includes this file, we need to comply with the information in it for moral and legal reasons.</p>
<p>We will look through the information in ZenRows Tutorial <a href="https://www.zenrows.com/blog/robots-txt-web-scraping">How to Read robots.txt for Web Scraping</a> and apply this to the <a href="https://www.nih.gov/robots.txt">NIH robots.txt file</a>.</p>
<p>From our investigation of the NIH <code>robots.txt</code>, we learn:</p>
<ul>
<li>
<code>User-agent: *</code>: Anyone is allowed to scrape</li>
<li>No <code>Crawl-delay</code> entry: no restriction on the scraping speed</li>
<li>No <code>Visit-time</code> entry: no restrictions on time of day that scraping is allowed</li>
<li>No <code>Request-rate</code> entry: no restrictions on simultaneous requests</li>
<li>No mention of <code>?page=</code>, <code>news-events</code>, <code>news-releases</code>, or <code>https://science.education.nih.gov/</code> in the <code>Disallow</code> sections. (This is what we want to scrape today.)</li>
</ul>
<p><strong>Further considerations</strong></p>
<p>The Towards Data Science article <a href="https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01">Ethics in Web Scraping‚Äìnot available as of 10/24/2025 :(</a> describes some good principles to ensure that we are valuing the labor that website owners invested to provide data and creating good from the information we do scrape.</p>
</section><section id="html-structure" class="level2"><h2 class="anchored" data-anchor-id="html-structure">HTML structure</h2>
<p>HTML (hypertext markup language) is the formatting language used to create webpages. Let‚Äôs look at the core parts of HTML from the <a href="https://cran.r-project.org/web/packages/rvest/vignettes/rvest.html">rvest vignette</a>.</p>
<p>Key HTML Concepts:</p>
<ul>
<li>
<strong>Elements</strong> which consist of a start tag (e.g.&nbsp;<code>&lt;tag&gt;</code>) and end with an end tag (e.g.&nbsp;<code>&lt;/tag&gt;</code>)</li>
<li>Optional <strong>attributes</strong> (<code>id='first'</code>) within the start tag</li>
<li>
<strong>Contents</strong> of an element</li>
</ul>
<p>Key CSS Concepts:</p>
<ul>
<li>To identify part of the html code, we can use the tag type (e.g.&nbsp;<code>&lt;a&gt;</code>, <code>&lt;h1&gt;</code>, <code>&lt;p&gt;</code>) and class or id attributes.</li>
<li>Each element can have a <strong>class</strong> attribute and/or an <strong>id</strong> attribute.</li>
<li>We can also identify parts of the code based on whether they are children or descendants of other elements, in that they are contained within an element. We won‚Äôt need this for simple applications.</li>
</ul></section><section id="finding-css-selectors" class="level2"><h2 class="anchored" data-anchor-id="finding-css-selectors">Finding CSS Selectors</h2>
<p>In order to gather information from a webpage, we must learn the language used to identify patterns of specific information. For example, on the <a href="https://www.nih.gov/news-events/news-releases">NIH News Releases page</a>, we can see that the data is represented in a consistent pattern of image + title + abstract.</p>
<p>We will identify data in a web page using a pattern matching language called <a href="https://css-tricks.com/how-css-selectors-work/">CSS Selectors</a> that can refer to specific patterns in HTML, the language used to write web pages.</p>
<p>For example:</p>
<ul>
<li>Selecting by element/tag type:
<ul>
<li>
<code>"a"</code> selects all hyperlinks in a webpage (‚Äúa‚Äù represents ‚Äúanchor‚Äù links in HTML)</li>
<li>
<code>"p"</code> selects all paragraph elements</li>
</ul>
</li>
<li>Selecting by class and ID:
<ul>
<li>
<code>".description"</code> selects all elements with <code>class</code> equal to ‚Äúdescription‚Äù
<ul>
<li>The <code>.</code> at the beginning is what signifies <code>class</code> selection.</li>
<li>This is one of the most common CSS selectors for scraping because in HTML, the <code>class</code> attribute is extremely commonly used to format webpage elements. (Any number of HTML elements can have the same <code>class</code>, which is not true for the <code>id</code> attribute.)</li>
</ul>
</li>
<li>
<code>"#mainTitle"</code> selects the SINGLE element with <strong>id</strong> equal to ‚ÄúmainTitle‚Äù
<ul>
<li>The <code>#</code> at the beginning is what signifies <code>id</code> selection.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"title"</span><span class="dt">&gt;</span>Title of resource 1<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"description"</span><span class="dt">&gt;</span>Description of resource 1<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"title"</span><span class="dt">&gt;</span>Title of resource 2<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"description"</span><span class="dt">&gt;</span>Description of resource 2<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Warning</strong>: Websites change often! So if you are going to scrape a lot of data, it is probably worthwhile to save and date a copy of the website (File &gt; Save As). Otherwise, you may return after some time and your scraping code will include all of the wrong CSS selectors.</p>
<p>Although you can learn how to use CSS Selectors by hand (<a href="https://css-tricks.com/how-css-selectors-work/">CSS Selectors</a>), we will use a shortcut by installing the <a href="http://selectorgadget.com/">Selector Gadget</a> tool.</p>
<ul>
<li>There is a version available for Chrome‚Äìadd it to Chrome via the <a href="https://chromewebstore.google.com/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb">Chome Web Store</a>.
<ul>
<li>Make sure to pin the extension to the menu bar. (Click the 3 dots &gt; Extensions &gt; Manage extensions. Click the ‚ÄúDetails‚Äù button under SelectorGadget and toggle the ‚ÄúPin to toolbar‚Äù option.)</li>
</ul>
</li>
<li>There is also a version that can be saved as a bookmark in the browser‚Äìsee <a href="https://rvest.tidyverse.org/articles/selectorgadget.html">here</a>.</li>
</ul>
<p>Let‚Äôs watch the Selector Gadget <a href="http://selectorgadget.com/">tutorial video</a> before proceeding.</p>
</section><section id="example-1-nih-new-releases" class="level2"><h2 class="anchored" data-anchor-id="example-1-nih-new-releases">Example 1: NIH New Releases</h2>
<p>Head over to the <a href="https://www.nih.gov/news-events/news-releases">NIH News Releases page</a>.</p>
<p>Click the Selector Gadget extension icon or bookmark button.</p>
<p>As you mouse over the webpage, different parts will be highlighted in orange.</p>
<p>Click on the title of the first news release.</p>
<p>You‚Äôll notice that the Selector Gadget information in the lower right describes what you clicked on.</p>
<p>Scroll through the page to verify that only the information you intend (the description paragraph) is selected.</p>
<ul>
<li>The selector panel shows the CSS selector (<code>.thumbnail-teaser__heading</code>) and the number of matches for that CSS selector (10). (You may have to be careful with your clicking‚Äìthere are two overlapping boxes, and clicking on the link of the title can lead to the CSS selector of ‚Äúa‚Äù.)</li>
</ul>
<p><strong>Exercise:</strong> Repeat the process above to find the correct selectors for the following fields. Make sure that each matches 10 results:</p>
<ul>
<li>The publication date</li>
<li>The article abstract paragraph (which will also include the publication date)</li>
</ul></section><section id="retrieving-data-using-rvest-and-css-selectors" class="level2"><h2 class="anchored" data-anchor-id="retrieving-data-using-rvest-and-css-selectors">Retrieving Data Using <code>rvest</code> and CSS Selectors</h2>
<p>Now that we have identified CSS selectors for the information we need, let‚Äôs fetch the data using the <code>rvest</code> package.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>nih <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.nih.gov/news-events/news-releases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once the webpage is loaded, we can retrieve data using the CSS selectors we specified earlier. The following code retrieves the article titles:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Retrieve and inspect article titles</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>article_titles <span class="ot">&lt;-</span> nih <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="fu">html_elements</span>(<span class="st">".thumbnail-teaser__heading"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="fu">html_text</span>()</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">head</span>(article_titles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Researchers find genetic basis for important risk factor in blinding eye disease"                          
[2] "Dr. Kyle Walsh selected to lead the National Institute of Environmental Health Sciences"                   
[3] "HHS Doubles AI-Backed Childhood Cancer Research Funding"                                                   
[4] "Secretary Kennedy Swears in Dr. Anthony Letai as Director of the National Cancer Institute"                
[5] "NIH establishes nation's first dedicated organoid development center to reduce reliance on animal modeling"
[6] "NIH launches $50M Autism Data Science Initiative to unlock causes and improve outcomes"                    </code></pre>
</div>
</div>
<p><strong>Exercise:</strong> Our goal is to get article titles, publication dates, and abstract text for news releases across several pages of results.</p>
<p><strong>Before doing any coding,</strong> plan your approach.</p>
<ul>
<li>What functions will you write?</li>
<li>What arguments will they have?</li>
<li>How will you use your functions?</li>
</ul>
<p>Consult with your peers and compare plans.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Stop to reflect">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop to reflect
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write a few observations about your comfort/confidence in this planning exercise. As you proceed through the implementation of this plan in the next steps, make notes about any places you struggled, were uncertain, or benefited from peer input.</p>
</div>
</div>
<p><strong>Exercise:</strong> Carry out your plan to get the article title, publication date, and abstract text for the first 5 pages of news releases in a single data frame. You will need to write at least one function, and you will need iteration‚ÄìStart with an appropriate <code>map()</code> function from <code>purrr</code>. If you have time, also try to use a <code>for</code> loop instead.</p>
<p>Notes:</p>
<ul>
<li><p>Mouse over the page buttons at the very bottom of the news home page to see what the URLs look like.</p></li>
<li><p>The abstract should not have the publication date‚Äìuse <code>stringr</code> and regular expressions to remove the publication date.</p></li>
<li><p>If the website has <code>Crawl-delay: x</code> in its <code>robots.txt</code>, include <code>Sys.sleep(x)</code> in your function to respect that.</p></li>
<li><p>Recall that <code>bind_rows()</code> from <code>dplyr</code> and <code>list_rbind()</code> from <code>purrr</code> takes a list of data frames and stacks them on top of each other.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>    <span class="co"># Helper function to reduce html_elements() |&gt; html_text() code duplication</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    get_text_from_page <span class="ot">&lt;-</span> <span class="cf">function</span>(page, css_selector) {</span>
<span id="cb5-3"><a href="#cb5-3"></a>    page <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>        <span class="fu">html_elements</span>(css_selector) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>        <span class="fu">html_text</span>()</span>
<span id="cb5-6"><a href="#cb5-6"></a>    }</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>    scrape_page <span class="ot">&lt;-</span> <span class="cf">function</span>(url) {</span>
<span id="cb5-9"><a href="#cb5-9"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a>    page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb5-11"><a href="#cb5-11"></a>    article_titles <span class="ot">&lt;-</span> <span class="fu">get_text_from_page</span>(page, <span class="st">".thumbnail-teaser__heading"</span>)</span>
<span id="cb5-12"><a href="#cb5-12"></a>    article_dates_abstracts <span class="ot">&lt;-</span> <span class="fu">get_text_from_page</span>(page, <span class="st">".thumbnail-teaser__description"</span>)</span>
<span id="cb5-13"><a href="#cb5-13"></a></span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="fu">tibble</span>(</span>
<span id="cb5-15"><a href="#cb5-15"></a>        <span class="at">title =</span> article_titles,</span>
<span id="cb5-16"><a href="#cb5-16"></a>        <span class="at">date_abstract =</span> article_dates_abstracts</span>
<span id="cb5-17"><a href="#cb5-17"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb5-18"><a href="#cb5-18"></a>    <span class="fu">separate_wider_delim</span>(</span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="at">delim =</span> <span class="st">" ‚Äî "</span>, </span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="at">cols =</span> date_abstract, </span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"pub_date"</span>, <span class="st">"abstract"</span>))</span>
<span id="cb5-22"><a href="#cb5-22"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Create a character vector of URLs for the first 5 pages</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>base_url <span class="ot">&lt;-</span> <span class="st">"https://www.nih.gov/news-events/news-releases"</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>urls_all_pages <span class="ot">&lt;-</span> <span class="fu">c</span>(base_url, <span class="fu">str_c</span>(base_url, <span class="st">"?page="</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>pages2 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(urls_all_pages, scrape_page)</span>
<span id="cb6-6"><a href="#cb6-6"></a>df_articles2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pages2)</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="fu">head</span>(df_articles2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  title                                                        pub_date abstract
  &lt;chr&gt;                                                        &lt;chr&gt;    &lt;chr&gt;   
1 Researchers find genetic basis for important risk factor in‚Ä¶ Decembe‚Ä¶ "  Inte‚Ä¶
2 Dr. Kyle Walsh selected to lead the National Institute of E‚Ä¶ Novembe‚Ä¶ "  Dr. ‚Ä¶
3 HHS Doubles AI-Backed Childhood Cancer Research Funding      Septemb‚Ä¶ "  Foll‚Ä¶
4 Secretary Kennedy Swears in Dr. Anthony Letai as Director o‚Ä¶ Septemb‚Ä¶ "  Dr. ‚Ä¶
5 NIH establishes nation's first dedicated organoid developme‚Ä¶ Septemb‚Ä¶ "  The ‚Ä¶
6 NIH launches $50M Autism Data Science Initiative to unlock ‚Ä¶ Septemb‚Ä¶ "  Fund‚Ä¶</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#For Loop</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>pages <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">5</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb8-5"><a href="#cb8-5"></a>    base_url <span class="ot">&lt;-</span> <span class="st">"https://www.nih.gov/news-events/news-releases"</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="cf">if</span> (i<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb8-7"><a href="#cb8-7"></a>        url <span class="ot">&lt;-</span> base_url</span>
<span id="cb8-8"><a href="#cb8-8"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-9"><a href="#cb8-9"></a>        url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(base_url, <span class="st">"?page="</span>, i<span class="dv">-1</span>)</span>
<span id="cb8-10"><a href="#cb8-10"></a>    }</span>
<span id="cb8-11"><a href="#cb8-11"></a>    pages[[i]] <span class="ot">&lt;-</span> <span class="fu">scrape_page</span>(url)</span>
<span id="cb8-12"><a href="#cb8-12"></a>}</span>
<span id="cb8-13"><a href="#cb8-13"></a></span>
<span id="cb8-14"><a href="#cb8-14"></a>df_articles <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pages)</span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="fu">head</span>(df_articles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  title                                                        pub_date abstract
  &lt;chr&gt;                                                        &lt;chr&gt;    &lt;chr&gt;   
1 Researchers find genetic basis for important risk factor in‚Ä¶ Decembe‚Ä¶ "  Inte‚Ä¶
2 Dr. Kyle Walsh selected to lead the National Institute of E‚Ä¶ Novembe‚Ä¶ "  Dr. ‚Ä¶
3 HHS Doubles AI-Backed Childhood Cancer Research Funding      Septemb‚Ä¶ "  Foll‚Ä¶
4 Secretary Kennedy Swears in Dr. Anthony Letai as Director o‚Ä¶ Septemb‚Ä¶ "  Dr. ‚Ä¶
5 NIH establishes nation's first dedicated organoid developme‚Ä¶ Septemb‚Ä¶ "  The ‚Ä¶
6 NIH launches $50M Autism Data Science Initiative to unlock ‚Ä¶ Septemb‚Ä¶ "  Fund‚Ä¶</code></pre>
</div>
</div>
</section><section id="example-2-nih-stem-teaching-resources" class="level2"><h2 class="anchored" data-anchor-id="example-2-nih-stem-teaching-resources">Example 2: NIH STEM Teaching Resources</h2>
<p>Let‚Äôs look at a more complex example with the <a href="https://science.education.nih.gov/">NIH STEM Teaching Resources webpage</a>.</p>
<ul>
<li>Using Selector Gadget to select the resource titles can be tricky if we can only get one resource title at a time.</li>
<li>In Chrome, you can right click part of a web page and click ‚ÄúInspect‚Äù. This opens up Chrome‚Äôs Developer Tools. Mousing over the HTML in the top right panel highlights the corresponding part of the web page.
<ul>
<li>For non-Chrome browsers, use the Help menu to search for Developer Tools.</li>
</ul>
</li>
</ul>
<p>The underlying HTML used to create a web page is also called the page <strong>source code</strong> or <strong>page source</strong>.</p>
<p>We learn from this that the resource titles are <code>&lt;h4&gt;</code> headings that have the class <code>resource-title</code>.</p>
<p>We can infer from this that <code>.resource-title</code> would be the CSS selector for the resource titles. ## Done!</p>
<ul>
<li>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../../src/ica/14-apis-2-notes.html" class="pagination-link" aria-label="14 APIs P2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">14 APIs P2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../src/appx/Exam2SummarySheet.html" class="pagination-link" aria-label="---">
        <span class="nav-page-text"><span class="chapter-title">‚Äî</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="an">title:</span><span class="co"> "15 Web scraping"</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">---</span></span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="fu">## üß© Learning Goals</span></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>By the end of this lesson, you should be able to: - Use CSS Selectors and the Selector Gadget tool to locate data of interest within a webpage - Use the <span class="in">`html_elements()`</span>, <span class="in">`html_text()`</span>, and <span class="in">`html_attr()`</span> functions within the <span class="in">`rvest`</span> packages to scrape data from webpage using CSS selectors.</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="in">```{r setup_15, echo=FALSE, message=FALSE}</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="fu">library</span>(rvest)</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="in">```</span></span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="fu">## When to Use</span></span>
<span id="cb10-15"><a href="#cb10-15"></a></span>
<span id="cb10-16"><a href="#cb10-16"></a>We have talked about how to acquire data from APIs.</span>
<span id="cb10-17"><a href="#cb10-17"></a>Whenever an API is available for your project, you should default to getting data from the API.</span>
<span id="cb10-18"><a href="#cb10-18"></a>Sometimes an API will not be available, and **web scraping** is another means of getting data.</span>
<span id="cb10-19"><a href="#cb10-19"></a></span>
<span id="cb10-20"><a href="#cb10-20"></a>Web scraping describes the use of code to extract information displayed on a web page.</span>
<span id="cb10-21"><a href="#cb10-21"></a>In R, the <span class="in">`rvest`</span> package offers tools for scraping.</span>
<span id="cb10-22"><a href="#cb10-22"></a>(<span class="in">`rvest`</span> is meant to sound like "harvest".)</span>
<span id="cb10-23"><a href="#cb10-23"></a></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="fu">## Ethics</span></span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="in">`robots.txt`</span> is a file that some websites includes to clarify what can and cannot be scraped in addition to other constraints about scraping.</span>
<span id="cb10-27"><a href="#cb10-27"></a>When a website includes this file, we need to comply with the information in it for moral and legal reasons.</span>
<span id="cb10-28"><a href="#cb10-28"></a></span>
<span id="cb10-29"><a href="#cb10-29"></a>We will look through the information in ZenRows Tutorial <span class="co">[</span><span class="ot">How to Read robots.txt for Web Scraping</span><span class="co">](https://www.zenrows.com/blog/robots-txt-web-scraping)</span> and apply this to the <span class="co">[</span><span class="ot">NIH robots.txt file</span><span class="co">](https://www.nih.gov/robots.txt)</span>.</span>
<span id="cb10-30"><a href="#cb10-30"></a></span>
<span id="cb10-31"><a href="#cb10-31"></a>From our investigation of the NIH <span class="in">`robots.txt`</span>, we learn:</span>
<span id="cb10-32"><a href="#cb10-32"></a></span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="ss">-   </span><span class="in">`User-agent: *`</span>: Anyone is allowed to scrape</span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="ss">-   </span>No <span class="in">`Crawl-delay`</span> entry: no restriction on the scraping speed</span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="ss">-   </span>No <span class="in">`Visit-time`</span> entry: no restrictions on time of day that scraping is allowed</span>
<span id="cb10-36"><a href="#cb10-36"></a><span class="ss">-   </span>No <span class="in">`Request-rate`</span> entry: no restrictions on simultaneous requests</span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="ss">-   </span>No mention of <span class="in">`?page=`</span>, <span class="in">`news-events`</span>, <span class="in">`news-releases`</span>, or <span class="in">`https://science.education.nih.gov/`</span> in the <span class="in">`Disallow`</span> sections. (This is what we want to scrape today.)</span>
<span id="cb10-38"><a href="#cb10-38"></a></span>
<span id="cb10-39"><a href="#cb10-39"></a>**Further considerations**</span>
<span id="cb10-40"><a href="#cb10-40"></a></span>
<span id="cb10-41"><a href="#cb10-41"></a>The Towards Data Science article <span class="co">[</span><span class="ot">Ethics in Web Scraping--not available as of 10/24/2025 :(</span><span class="co">](https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01)</span> describes some good principles to ensure that we are valuing the labor that website owners invested to provide data and creating good from the information we do scrape.</span>
<span id="cb10-42"><a href="#cb10-42"></a></span>
<span id="cb10-43"><a href="#cb10-43"></a><span class="fu">## HTML structure</span></span>
<span id="cb10-44"><a href="#cb10-44"></a></span>
<span id="cb10-45"><a href="#cb10-45"></a>HTML (hypertext markup language) is the formatting language used to create webpages.</span>
<span id="cb10-46"><a href="#cb10-46"></a>Let's look at the core parts of HTML from the <span class="co">[</span><span class="ot">rvest vignette</span><span class="co">](https://cran.r-project.org/web/packages/rvest/vignettes/rvest.html)</span>.</span>
<span id="cb10-47"><a href="#cb10-47"></a></span>
<span id="cb10-48"><a href="#cb10-48"></a>Key HTML Concepts:</span>
<span id="cb10-49"><a href="#cb10-49"></a></span>
<span id="cb10-50"><a href="#cb10-50"></a><span class="ss">-   </span>**Elements** which consist of a start tag (e.g. <span class="in">`&lt;tag&gt;`</span>) and end with an end tag (e.g. <span class="in">`&lt;/tag&gt;`</span>)</span>
<span id="cb10-51"><a href="#cb10-51"></a><span class="ss">-   </span>Optional **attributes** (<span class="in">`id='first'`</span>) within the start tag</span>
<span id="cb10-52"><a href="#cb10-52"></a><span class="ss">-   </span>**Contents** of an element</span>
<span id="cb10-53"><a href="#cb10-53"></a></span>
<span id="cb10-54"><a href="#cb10-54"></a>Key CSS Concepts:</span>
<span id="cb10-55"><a href="#cb10-55"></a></span>
<span id="cb10-56"><a href="#cb10-56"></a><span class="ss">-   </span>To identify part of the html code, we can use the tag type (e.g. <span class="in">`&lt;a&gt;`</span>, <span class="in">`&lt;h1&gt;`</span>, <span class="in">`&lt;p&gt;`</span>) and class or id attributes.</span>
<span id="cb10-57"><a href="#cb10-57"></a><span class="ss">-   </span>Each element can have a **class** attribute and/or an **id** attribute.</span>
<span id="cb10-58"><a href="#cb10-58"></a><span class="ss">-   </span>We can also identify parts of the code based on whether they are children or descendants of other elements, in that they are contained within an element. We won't need this for simple applications.</span>
<span id="cb10-59"><a href="#cb10-59"></a></span>
<span id="cb10-60"><a href="#cb10-60"></a><span class="fu">## Finding CSS Selectors</span></span>
<span id="cb10-61"><a href="#cb10-61"></a></span>
<span id="cb10-62"><a href="#cb10-62"></a>In order to gather information from a webpage, we must learn the language used to identify patterns of specific information.</span>
<span id="cb10-63"><a href="#cb10-63"></a>For example, on the <span class="co">[</span><span class="ot">NIH News Releases page</span><span class="co">](https://www.nih.gov/news-events/news-releases)</span>, we can see that the data is represented in a consistent pattern of image + title + abstract.</span>
<span id="cb10-64"><a href="#cb10-64"></a></span>
<span id="cb10-65"><a href="#cb10-65"></a>We will identify data in a web page using a pattern matching language called <span class="co">[</span><span class="ot">CSS Selectors</span><span class="co">](https://css-tricks.com/how-css-selectors-work/)</span> that can refer to specific patterns in HTML, the language used to write web pages.</span>
<span id="cb10-66"><a href="#cb10-66"></a></span>
<span id="cb10-67"><a href="#cb10-67"></a>For example:</span>
<span id="cb10-68"><a href="#cb10-68"></a></span>
<span id="cb10-69"><a href="#cb10-69"></a><span class="ss">-   </span>Selecting by element/tag type:</span>
<span id="cb10-70"><a href="#cb10-70"></a><span class="ss">    -   </span><span class="in">`"a"`</span> selects all hyperlinks in a webpage ("a" represents "anchor" links in HTML)</span>
<span id="cb10-71"><a href="#cb10-71"></a><span class="ss">    -   </span><span class="in">`"p"`</span> selects all paragraph elements</span>
<span id="cb10-72"><a href="#cb10-72"></a><span class="ss">-   </span>Selecting by class and ID:</span>
<span id="cb10-73"><a href="#cb10-73"></a><span class="ss">    -   </span><span class="in">`".description"`</span> selects all elements with <span class="in">`class`</span> equal to "description"</span>
<span id="cb10-74"><a href="#cb10-74"></a><span class="ss">        -   </span>The <span class="in">`.`</span> at the beginning is what signifies <span class="in">`class`</span> selection.</span>
<span id="cb10-75"><a href="#cb10-75"></a><span class="ss">        -   </span>This is one of the most common CSS selectors for scraping because in HTML, the <span class="in">`class`</span> attribute is extremely commonly used to format webpage elements. (Any number of HTML elements can have the same <span class="in">`class`</span>, which is not true for the <span class="in">`id`</span> attribute.)</span>
<span id="cb10-76"><a href="#cb10-76"></a><span class="ss">    -   </span><span class="in">`"#mainTitle"`</span> selects the SINGLE element with **id** equal to "mainTitle"</span>
<span id="cb10-77"><a href="#cb10-77"></a><span class="ss">        -   </span>The <span class="in">`#`</span> at the beginning is what signifies <span class="in">`id`</span> selection.</span>
<span id="cb10-78"><a href="#cb10-78"></a></span>
<span id="cb10-79"><a href="#cb10-79"></a><span class="in">``` html</span></span>
<span id="cb10-80"><a href="#cb10-80"></a><span class="op">&lt;</span>p class<span class="op">=</span><span class="st">"title"</span><span class="op">&gt;</span>Title of resource <span class="dv">1</span><span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb10-81"><a href="#cb10-81"></a><span class="op">&lt;</span>p class<span class="op">=</span><span class="st">"description"</span><span class="op">&gt;</span>Description of resource <span class="dv">1</span><span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb10-82"><a href="#cb10-82"></a></span>
<span id="cb10-83"><a href="#cb10-83"></a><span class="op">&lt;</span>p class<span class="op">=</span><span class="st">"title"</span><span class="op">&gt;</span>Title of resource <span class="dv">2</span><span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb10-84"><a href="#cb10-84"></a><span class="op">&lt;</span>p class<span class="op">=</span><span class="st">"description"</span><span class="op">&gt;</span>Description of resource <span class="dv">2</span><span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb10-85"><a href="#cb10-85"></a><span class="in">```</span></span>
<span id="cb10-86"><a href="#cb10-86"></a></span>
<span id="cb10-87"><a href="#cb10-87"></a>**Warning**: Websites change often!</span>
<span id="cb10-88"><a href="#cb10-88"></a>So if you are going to scrape a lot of data, it is probably worthwhile to save and date a copy of the website (File <span class="sc">\&gt;</span> Save As).</span>
<span id="cb10-89"><a href="#cb10-89"></a>Otherwise, you may return after some time and your scraping code will include all of the wrong CSS selectors.</span>
<span id="cb10-90"><a href="#cb10-90"></a></span>
<span id="cb10-91"><a href="#cb10-91"></a>Although you can learn how to use CSS Selectors by hand (<span class="co">[</span><span class="ot">CSS Selectors</span><span class="co">](https://css-tricks.com/how-css-selectors-work/)</span>), we will use a shortcut by installing the <span class="co">[</span><span class="ot">Selector Gadget</span><span class="co">](http://selectorgadget.com/)</span> tool.</span>
<span id="cb10-92"><a href="#cb10-92"></a></span>
<span id="cb10-93"><a href="#cb10-93"></a><span class="ss">-   </span>There is a version available for Chrome--add it to Chrome via the <span class="co">[</span><span class="ot">Chome Web Store</span><span class="co">](https://chromewebstore.google.com/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb)</span>.</span>
<span id="cb10-94"><a href="#cb10-94"></a><span class="ss">    -   </span>Make sure to pin the extension to the menu bar. (Click the 3 dots <span class="sc">\&gt;</span> Extensions <span class="sc">\&gt;</span> Manage extensions. Click the "Details" button under SelectorGadget and toggle the "Pin to toolbar" option.)</span>
<span id="cb10-95"><a href="#cb10-95"></a><span class="ss">-   </span>There is also a version that can be saved as a bookmark in the browser--see <span class="co">[</span><span class="ot">here</span><span class="co">](https://rvest.tidyverse.org/articles/selectorgadget.html)</span>.</span>
<span id="cb10-96"><a href="#cb10-96"></a></span>
<span id="cb10-97"><a href="#cb10-97"></a>Let's watch the Selector Gadget <span class="co">[</span><span class="ot">tutorial video</span><span class="co">](http://selectorgadget.com/)</span> before proceeding.</span>
<span id="cb10-98"><a href="#cb10-98"></a></span>
<span id="cb10-99"><a href="#cb10-99"></a><span class="fu">## Example 1: NIH New Releases</span></span>
<span id="cb10-100"><a href="#cb10-100"></a></span>
<span id="cb10-101"><a href="#cb10-101"></a>Head over to the <span class="co">[</span><span class="ot">NIH News Releases page</span><span class="co">](https://www.nih.gov/news-events/news-releases)</span>.</span>
<span id="cb10-102"><a href="#cb10-102"></a></span>
<span id="cb10-103"><a href="#cb10-103"></a>Click the Selector Gadget extension icon or bookmark button.</span>
<span id="cb10-104"><a href="#cb10-104"></a></span>
<span id="cb10-105"><a href="#cb10-105"></a>As you mouse over the webpage, different parts will be highlighted in orange.</span>
<span id="cb10-106"><a href="#cb10-106"></a></span>
<span id="cb10-107"><a href="#cb10-107"></a>Click on the title of the first news release.</span>
<span id="cb10-108"><a href="#cb10-108"></a></span>
<span id="cb10-109"><a href="#cb10-109"></a>You'll notice that the Selector Gadget information in the lower right describes what you clicked on.</span>
<span id="cb10-110"><a href="#cb10-110"></a></span>
<span id="cb10-111"><a href="#cb10-111"></a>Scroll through the page to verify that only the information you intend (the description paragraph) is selected.</span>
<span id="cb10-112"><a href="#cb10-112"></a></span>
<span id="cb10-113"><a href="#cb10-113"></a><span class="ss">-   </span>The selector panel shows the CSS selector (<span class="in">`.thumbnail-teaser__heading`</span>) and the number of matches for that CSS selector (10). (You may have to be careful with your clicking--there are two overlapping boxes, and clicking on the link of the title can lead to the CSS selector of "a".)</span>
<span id="cb10-114"><a href="#cb10-114"></a></span>
<span id="cb10-115"><a href="#cb10-115"></a>**Exercise:** Repeat the process above to find the correct selectors for the following fields.</span>
<span id="cb10-116"><a href="#cb10-116"></a>Make sure that each matches 10 results:</span>
<span id="cb10-117"><a href="#cb10-117"></a></span>
<span id="cb10-118"><a href="#cb10-118"></a><span class="ss">-   </span>The publication date</span>
<span id="cb10-119"><a href="#cb10-119"></a><span class="ss">-   </span>The article abstract paragraph (which will also include the publication date)</span>
<span id="cb10-120"><a href="#cb10-120"></a></span>
<span id="cb10-121"><a href="#cb10-121"></a><span class="fu">## Retrieving Data Using `rvest` and CSS Selectors</span></span>
<span id="cb10-122"><a href="#cb10-122"></a></span>
<span id="cb10-123"><a href="#cb10-123"></a>Now that we have identified CSS selectors for the information we need, let's fetch the data using the <span class="in">`rvest`</span> package.</span>
<span id="cb10-124"><a href="#cb10-124"></a></span>
<span id="cb10-125"><a href="#cb10-125"></a><span class="in">```{r read_html}</span></span>
<span id="cb10-126"><a href="#cb10-126"></a>nih <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.nih.gov/news-events/news-releases"</span>)</span>
<span id="cb10-127"><a href="#cb10-127"></a><span class="in">```</span></span>
<span id="cb10-128"><a href="#cb10-128"></a></span>
<span id="cb10-129"><a href="#cb10-129"></a>Once the webpage is loaded, we can retrieve data using the CSS selectors we specified earlier.</span>
<span id="cb10-130"><a href="#cb10-130"></a>The following code retrieves the article titles:</span>
<span id="cb10-131"><a href="#cb10-131"></a></span>
<span id="cb10-132"><a href="#cb10-132"></a><span class="in">```{r html_elements_text}</span></span>
<span id="cb10-133"><a href="#cb10-133"></a><span class="co"># Retrieve and inspect article titles</span></span>
<span id="cb10-134"><a href="#cb10-134"></a>article_titles <span class="ot">&lt;-</span> nih <span class="sc">|&gt;</span></span>
<span id="cb10-135"><a href="#cb10-135"></a>    <span class="fu">html_elements</span>(<span class="st">".thumbnail-teaser__heading"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-136"><a href="#cb10-136"></a>    <span class="fu">html_text</span>()</span>
<span id="cb10-137"><a href="#cb10-137"></a><span class="fu">head</span>(article_titles)</span>
<span id="cb10-138"><a href="#cb10-138"></a><span class="in">```</span></span>
<span id="cb10-139"><a href="#cb10-139"></a></span>
<span id="cb10-140"><a href="#cb10-140"></a>**Exercise:** Our goal is to get article titles, publication dates, and abstract text for news releases across several pages of results.</span>
<span id="cb10-141"><a href="#cb10-141"></a></span>
<span id="cb10-142"><a href="#cb10-142"></a>**Before doing any coding,** plan your approach.</span>
<span id="cb10-143"><a href="#cb10-143"></a></span>
<span id="cb10-144"><a href="#cb10-144"></a><span class="ss">-   </span>What functions will you write?</span>
<span id="cb10-145"><a href="#cb10-145"></a><span class="ss">-   </span>What arguments will they have?</span>
<span id="cb10-146"><a href="#cb10-146"></a><span class="ss">-   </span>How will you use your functions?</span>
<span id="cb10-147"><a href="#cb10-147"></a></span>
<span id="cb10-148"><a href="#cb10-148"></a>Consult with your peers and compare plans.</span>
<span id="cb10-149"><a href="#cb10-149"></a></span>
<span id="cb10-150"><a href="#cb10-150"></a>::: {.callout-tip title="Stop to reflect"}</span>
<span id="cb10-151"><a href="#cb10-151"></a>Write a few observations about your comfort/confidence in this planning exercise.</span>
<span id="cb10-152"><a href="#cb10-152"></a>As you proceed through the implementation of this plan in the next steps, make notes about any places you struggled, were uncertain, or benefited from peer input.</span>
<span id="cb10-153"><a href="#cb10-153"></a>:::</span>
<span id="cb10-154"><a href="#cb10-154"></a></span>
<span id="cb10-155"><a href="#cb10-155"></a>**Exercise:** Carry out your plan to get the article title, publication date, and abstract text for the first 5 pages of news releases in a single data frame.</span>
<span id="cb10-156"><a href="#cb10-156"></a>You will need to write at least one function, and you will need iteration--Start with an appropriate <span class="in">`map()`</span> function from <span class="in">`purrr`</span>.</span>
<span id="cb10-157"><a href="#cb10-157"></a>If you have time, also try to use a <span class="in">`for`</span> loop instead.</span>
<span id="cb10-158"><a href="#cb10-158"></a></span>
<span id="cb10-159"><a href="#cb10-159"></a>Notes:</span>
<span id="cb10-160"><a href="#cb10-160"></a></span>
<span id="cb10-161"><a href="#cb10-161"></a><span class="ss">-   </span>Mouse over the page buttons at the very bottom of the news home page to see what the URLs look like.</span>
<span id="cb10-162"><a href="#cb10-162"></a></span>
<span id="cb10-163"><a href="#cb10-163"></a><span class="ss">-   </span>The abstract should not have the publication date--use <span class="in">`stringr`</span> and regular expressions to remove the publication date.</span>
<span id="cb10-164"><a href="#cb10-164"></a></span>
<span id="cb10-165"><a href="#cb10-165"></a><span class="ss">-   </span>If the website has <span class="in">`Crawl-delay: x`</span> in its <span class="in">`robots.txt`</span>, include <span class="in">`Sys.sleep(x)`</span> in your function to respect that.</span>
<span id="cb10-166"><a href="#cb10-166"></a></span>
<span id="cb10-167"><a href="#cb10-167"></a><span class="ss">-   </span>Recall that <span class="in">`bind_rows()`</span> from <span class="in">`dplyr`</span> and <span class="in">`list_rbind()`</span> from <span class="in">`purrr`</span> takes a list of data frames and stacks them on top of each other.</span>
<span id="cb10-168"><a href="#cb10-168"></a></span>
<span id="cb10-171"><a href="#cb10-171"></a><span class="in">```{r}</span></span>
<span id="cb10-172"><a href="#cb10-172"></a>    <span class="co"># Helper function to reduce html_elements() |&gt; html_text() code duplication</span></span>
<span id="cb10-173"><a href="#cb10-173"></a>    get_text_from_page <span class="ot">&lt;-</span> <span class="cf">function</span>(page, css_selector) {</span>
<span id="cb10-174"><a href="#cb10-174"></a>    page <span class="sc">|&gt;</span></span>
<span id="cb10-175"><a href="#cb10-175"></a>        <span class="fu">html_elements</span>(css_selector) <span class="sc">|&gt;</span></span>
<span id="cb10-176"><a href="#cb10-176"></a>        <span class="fu">html_text</span>()</span>
<span id="cb10-177"><a href="#cb10-177"></a>    }</span>
<span id="cb10-178"><a href="#cb10-178"></a></span>
<span id="cb10-179"><a href="#cb10-179"></a>    scrape_page <span class="ot">&lt;-</span> <span class="cf">function</span>(url) {</span>
<span id="cb10-180"><a href="#cb10-180"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb10-181"><a href="#cb10-181"></a>    page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb10-182"><a href="#cb10-182"></a>    article_titles <span class="ot">&lt;-</span> <span class="fu">get_text_from_page</span>(page, <span class="st">".thumbnail-teaser__heading"</span>)</span>
<span id="cb10-183"><a href="#cb10-183"></a>    article_dates_abstracts <span class="ot">&lt;-</span> <span class="fu">get_text_from_page</span>(page, <span class="st">".thumbnail-teaser__description"</span>)</span>
<span id="cb10-184"><a href="#cb10-184"></a></span>
<span id="cb10-185"><a href="#cb10-185"></a>    <span class="fu">tibble</span>(</span>
<span id="cb10-186"><a href="#cb10-186"></a>        <span class="at">title =</span> article_titles,</span>
<span id="cb10-187"><a href="#cb10-187"></a>        <span class="at">date_abstract =</span> article_dates_abstracts</span>
<span id="cb10-188"><a href="#cb10-188"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb10-189"><a href="#cb10-189"></a>    <span class="fu">separate_wider_delim</span>(</span>
<span id="cb10-190"><a href="#cb10-190"></a>    <span class="at">delim =</span> <span class="st">" ‚Äî "</span>, </span>
<span id="cb10-191"><a href="#cb10-191"></a>    <span class="at">cols =</span> date_abstract, </span>
<span id="cb10-192"><a href="#cb10-192"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"pub_date"</span>, <span class="st">"abstract"</span>))</span>
<span id="cb10-193"><a href="#cb10-193"></a>    }</span>
<span id="cb10-194"><a href="#cb10-194"></a><span class="in">```</span></span>
<span id="cb10-195"><a href="#cb10-195"></a></span>
<span id="cb10-198"><a href="#cb10-198"></a><span class="in">```{r}</span></span>
<span id="cb10-199"><a href="#cb10-199"></a><span class="co"># Create a character vector of URLs for the first 5 pages</span></span>
<span id="cb10-200"><a href="#cb10-200"></a>base_url <span class="ot">&lt;-</span> <span class="st">"https://www.nih.gov/news-events/news-releases"</span></span>
<span id="cb10-201"><a href="#cb10-201"></a>urls_all_pages <span class="ot">&lt;-</span> <span class="fu">c</span>(base_url, <span class="fu">str_c</span>(base_url, <span class="st">"?page="</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb10-202"><a href="#cb10-202"></a></span>
<span id="cb10-203"><a href="#cb10-203"></a>pages2 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(urls_all_pages, scrape_page)</span>
<span id="cb10-204"><a href="#cb10-204"></a>df_articles2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pages2)</span>
<span id="cb10-205"><a href="#cb10-205"></a><span class="fu">head</span>(df_articles2)</span>
<span id="cb10-206"><a href="#cb10-206"></a><span class="in">```</span></span>
<span id="cb10-207"><a href="#cb10-207"></a></span>
<span id="cb10-210"><a href="#cb10-210"></a><span class="in">```{r}</span></span>
<span id="cb10-211"><a href="#cb10-211"></a><span class="co">#For Loop</span></span>
<span id="cb10-212"><a href="#cb10-212"></a>pages <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">5</span>)</span>
<span id="cb10-213"><a href="#cb10-213"></a></span>
<span id="cb10-214"><a href="#cb10-214"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb10-215"><a href="#cb10-215"></a>    base_url <span class="ot">&lt;-</span> <span class="st">"https://www.nih.gov/news-events/news-releases"</span></span>
<span id="cb10-216"><a href="#cb10-216"></a>    <span class="cf">if</span> (i<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb10-217"><a href="#cb10-217"></a>        url <span class="ot">&lt;-</span> base_url</span>
<span id="cb10-218"><a href="#cb10-218"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-219"><a href="#cb10-219"></a>        url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(base_url, <span class="st">"?page="</span>, i<span class="dv">-1</span>)</span>
<span id="cb10-220"><a href="#cb10-220"></a>    }</span>
<span id="cb10-221"><a href="#cb10-221"></a>    pages[[i]] <span class="ot">&lt;-</span> <span class="fu">scrape_page</span>(url)</span>
<span id="cb10-222"><a href="#cb10-222"></a>}</span>
<span id="cb10-223"><a href="#cb10-223"></a></span>
<span id="cb10-224"><a href="#cb10-224"></a>df_articles <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pages)</span>
<span id="cb10-225"><a href="#cb10-225"></a><span class="fu">head</span>(df_articles)</span>
<span id="cb10-226"><a href="#cb10-226"></a><span class="in">```</span></span>
<span id="cb10-227"><a href="#cb10-227"></a></span>
<span id="cb10-228"><a href="#cb10-228"></a><span class="fu">## Example 2: NIH STEM Teaching Resources</span></span>
<span id="cb10-229"><a href="#cb10-229"></a></span>
<span id="cb10-230"><a href="#cb10-230"></a>Let's look at a more complex example with the <span class="co">[</span><span class="ot">NIH STEM Teaching Resources webpage</span><span class="co">](https://science.education.nih.gov/)</span>.</span>
<span id="cb10-231"><a href="#cb10-231"></a></span>
<span id="cb10-232"><a href="#cb10-232"></a><span class="ss">-   </span>Using Selector Gadget to select the resource titles can be tricky if we can only get one resource title at a time.</span>
<span id="cb10-233"><a href="#cb10-233"></a><span class="ss">-   </span>In Chrome, you can right click part of a web page and click "Inspect". This opens up Chrome's Developer Tools. Mousing over the HTML in the top right panel highlights the corresponding part of the web page.</span>
<span id="cb10-234"><a href="#cb10-234"></a><span class="ss">    -   </span>For non-Chrome browsers, use the Help menu to search for Developer Tools.</span>
<span id="cb10-235"><a href="#cb10-235"></a></span>
<span id="cb10-236"><a href="#cb10-236"></a>The underlying HTML used to create a web page is also called the page **source code** or **page source**.</span>
<span id="cb10-237"><a href="#cb10-237"></a></span>
<span id="cb10-238"><a href="#cb10-238"></a>We learn from this that the resource titles are <span class="in">`&lt;h4&gt;`</span> headings that have the class <span class="in">`resource-title`</span>.</span>
<span id="cb10-239"><a href="#cb10-239"></a></span>
<span id="cb10-240"><a href="#cb10-240"></a>We can infer from this that <span class="in">`.resource-title`</span> would be the CSS selector for the resource titles.</span>
<span id="cb10-241"><a href="#cb10-241"></a><span class="fu">## Done!</span></span>
<span id="cb10-242"><a href="#cb10-242"></a></span>
<span id="cb10-243"><a href="#cb10-243"></a><span class="ss">-   </span>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>